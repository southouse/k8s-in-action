## 아키텍쳐 이해
### 쿠버네티스 클러스터
- Control Plane
  - 구성 요소
    - etcd 분산 저장 스토리지
      - 키/값 형태
      - 저장된 모든 리소스의 완전한 JSON 표현을 저장
      - RAFT 합의 알고리즘 사용으로 대다수의 노드가 동의하는 현재 상태만을 저장하여 일관성을 유지
      - 합의 알고리즘에 의해 과반을 유지해야 하기 때문에, 홀수로 구성
    - API 서버
      - 모든 요청은 API 서버 한 곳에서 처리
      - 낙관적 잠금 메커니즘을 갖고 있어 오류를 줄이고, 항상 일관성을 유지
      - 잘못 설정된 오브젝트를 저장할 수 없도록 처리
      - 리소스 생성 과정
        - 클라이언트(kubectl) -> HTTP POST 요청 -> 인증 플러그인 -> 인가 플러그인 -> 어드미션 컨트롤 플러그인 -> 리소스 유효성 검사 -> etcd
        - 클라이언트 인증 또는 HTTP 헤더를 통해 **인증**
        - 인증된 사용자가 요청한 작업이 요청한 리소스를 대상으로 수행할 수 있는지를 **인가**
        - 데이터를 읽는 경우를 제외한 모든 경우가 어드미션 컨트롤 플러그인을 통함
      - 구성 요소가 배포된 리소스의 변경 사항을 관찰
    - 스케줄러
      - 기본 스케줄링 알고리즘
        - 모든 노드 중 파드를 스케줄링할 수 있는 노드 목록을 필터링
        - 우선순위를 정하고 가장 점수가 높은 노드를 선택
      - 미리 설정된 조건 함수 목록에 각 노드를 전달하여 수용 가능한 노드를 찾음
        - 하드웨어 리소스에 대한 파드 요청을 충족시키는 가?
        - 노드의 테인트나 톨러레이션을 허용하는가?
        - 파드가 노드에 어피니티, 안티 어피니티 규칙을 지정했는 가?
        - ... 등
    - 컨트롤러 매니저
      - API 서버로 배포된 리소스에 지정된 대로 시스템을 구성
      - 디플로이먼트 컨트롤러, 스테이트풀셋 컨트롤러, 노드 컨트롤러, 서비스 컨트롤러 등 거의 모든 리소스에 대해 컨트롤러가 존재
      - 조정 루프를 실행해 실제 상태를 원하는 상태로 조정
  - `kubectl get componentstatuses` 명령어로 각 구성 요소의 상태를 조회
  - 모든 구성 요소는 마스터 노드에서 실행
- Worker Node
  - Kubelet
  - 쿠버네티스 서비스 프록시
  - 컨테이너 런타임
- 애드온 구성 요소
  - 쿠버네티스 DNS 서버
  - 대시보드
  - 인그레스 컨트롤러
  - 힙스터
  - 컨테이너 네트워크 인터페이스
- 쿠버네티스 시스템 구성 요소는 오직 API 서버하고만 통신
