## Service
- 동일한 서비스를 제공하는 파드 그룹에 지속적인 단일 접점이 필요할 때 생성
- `spec.sessionAffinity` 옵션에 `ClientIP`를 지정하면 모든 요청을 매번 같은 Pod로 리디렉션
- 여러 포트를 지정할 수 있음
- 파드의 컨테이너 포트에 이름을 지정하면, 서비스에서 `targetPort`에 이름을 지정하여 사용할 수 있음
  - 파드에서 포트를 변경하더라도, 이름으로 참조하기 때문에 나중에 따로 서비스에서 변경할 필요가 없음
- 파드가 시작되면 각 서비스를 가리키는 환경변수 세트를 초기화
  - `k exec ${POD_NAME} -- env` 명령어로 확인
- 외부 엔드포인트를 서비스로 등록해 내부의 FQDN으로 참조가 가능 (`external-service-externalname.yaml`)
- 외부에 서비스를 노출하는 방법
  - Node Port
    - 노드 자체에서 포트를 열고 해당 포트로 수신된 트래픽을 전달
    - 여러 노드에 걸친 파드를 접근 가능
    - 외부로 연결을 수신하면 실제 클라이언트 IP(소스 IP)를 확인하기 어려움
  - Load Balancer
    - 클라이언트는 로드밸런서의 IP로 액세스하고, 트래픽을 모든 노드의 노드포트로 전달
    - 추가 인프라 제공 로드밸런서가 있는 노드포트 서비스
  - ingress
    - 여러 서비스를 하나의 인그레스로 노출할 수 있음
    - 서로 다른 경로, 호스트가 있어도 하나의 인그레스로 각각의 서비스에 매핑할 수 있음
    - 파드에 실행중인 애플리케이션은 TLS를 지원할 필요가 없고, 오직 클라이언트와 ingress controller 간 통신만 암호화하면 됨
  - `spec.externalTrafficPolicy`
    - `Cluster`(기본 값)로 설정하면 분배되는 파드 중 파드가 유실되는 것과 무관하게 동일한 트래픽을 전달함
      - ex. 노드 두개가 있을 때 파드가 없는 노드1에 요청을 보내도 노드2로 트래픽 됨
      - 여러 노드간 물리적 거리가 먼 경우에는 많은 Hop을 거치기 때문에 불필요한 라우팅을 초래함
    - `Local`로 설정하면 같은 노드 내에 있는 파드로만 트래픽을 전달
      - Hop 수를 줄일 수 있지만, 파드 관리가 되어 있지 않으면 서비스 장애가 발생할 수 있음
      - 트래픽 전달이 균등하게 이루어지지 않을 수 있음

- `spec.clusterIP`를 `None`으로 설정하면 파드에 연결할 수 있는 클러스터 IP를 생성하지 않기 때문에 `headless` 상태의 서비스가 됨
- `metadata.annotations.service.alpha.kubernetes.io/tolerate-unready-endpoints` 옵션에 `true` 값을 주면 readiness 상태와 관계 없이 모든 파드를 서비스에 추가함

## ReadinessProbe
- 주기적으로 프로브를 호출하여 파드가 준비되지 않았다면 서비스에서 제거
- `livenessProbe`는 상태가 좋지 않은 컨테이너를 새로 만드는 반면, readinessProbe는 서비스 요청에서만 제외하여 정상적인 파드만 수신할 수 있도록 함
- 파드에 readinessprobe가 정의되어 있지 않으면 시작하는 즉시 서비스에 연결되므로, 항상 정의해야 함